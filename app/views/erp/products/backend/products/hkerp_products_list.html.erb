<div class="">
    <table class="table table-advance table-hover table-striped table-checkable order-column" id="">
        <thead>
            <tr>
                <th width='1%'>
                    <%= erp_datalist_check_all %>
                </th>
                <th class="text-center">Code</th>
                <th class="text-center" width='40%'>Name</th>
                <th class="text-center">HK-Erp Price</th>
                <th class="text-center">THCN Price</th>
                <th class="sortable text-center" sort-by='products.stock'>Stock</th>
                <th class="text-center">Warranty</th>
                <th class="text-center">Status</th>
                <th class="text-right" width="7%"><%= t('.actions') %></th>
            </tr>
        </thead>
        <tbody>
            <% @products["products"].each do |product| %>
                <% erp_product = Erp::Products::HkerpProduct.get_product_by_hkerp_product_id(product["id"]) %>
                <tr class="odd gradeX">
                    <td>
                        <%= erp_datalist_check_row(id: erp_product.id) if erp_product.present? %>
                    </td>
                    <td class="text-center">
                        <%= product["id"] %>
                    </td>
                    <td>
                        <span style="font-weight: 500"><%= product["display_name"] %></span>
                        <% if !erp_product.nil? %>
                            <% str1 = product["display_name"] %>
                            <% str2 = erp_product.name %>
                            
                            <% if str1 == str2 %>
                                <div class="" style="color: #999"><%= erp_product.name %></div>
                            <% else %>
                                <div class="" style="color: #d91e18"><%= erp_product.name %></div>
                            <% end %>
                            <% if erp_product.short_name.present? %>
                                <% str3 = erp_product.short_name %>
                                <% if str2 == str3 %>
                                    <em style="color: #999"><strong>Tên rút gọn: </strong><%= erp_product.short_name %></em>
                                <% else %>
                                    <em style="color: #c49f47"><strong>Tên rút gọn: </strong><%= erp_product.short_name %></em>
                                <% end %>
                            <% end %>
                        <% end %>
                    </td>
                    <td class="text-nowrap text-center">
                        <%= format_price(product["price"]) %>
                    </td>
                    <td class="text-nowrap text-center">
                        <%= format_price(erp_product.price) if erp_product.present? %>
                    </td>
                    <td>
                        <%= product["stock"] %>
                    </td>
                    <td class="text-center">
                        <%= product["warranty"] %>
                        <% if !erp_product.nil? %>
                            <% if erp_product.warranty.present? %>
                                <br><span style="color: #1ba39c"><%= erp_product.warranty %></span>
                            <% else %>
                                <br><span style="color: #d91e18">Chưa update</span>
                            <% end %>
                            <% if erp_product.meta_description.present? %>
                                <br><span style="color: #1ba39c">Đã SEO</span>
                            <% else %>
                                <br><span style="color: #d91e18">Chưa SEO</span>
                            <% end %>
                        <% end %>
                    </td>
                    <td class="text-center">
                        <% if erp_product.nil? %>
                            <% Erp::Products::Product.check_hkerp_product_imported(product["id"]) %>
                            <span class="label label-sm bg-grey">new</span>
                        <% else %>
                            <span class="label label-sm label-success">imported</span>
                            <% if erp_product.price.to_f == product["price"].to_f %>
                                <span class="label label-sm label-success">price updated</span>
                            <% else %>
                                <span class="label label-sm label-warning">price oudated</span>
                            <% end %>
                            <% if erp_product.is_sold_out %>
                                <span class="label label-sm bg-yellow">sold_out</span>
                            <% end %>
                        <% end %>
                        <% if product["out_of_date"] == true %>
                            <span class="label label-sm label-danger">Outdated</span>
                        <% end %>
                        <% if product["suspended"] %>
                            <span class="label label-sm label-danger">suspended</span>
                        <% end %>
                        <% if product["status"].to_i == 0 %>
                            <span class="label label-sm bg-dark">trashed</span>
                        <% end %>
                    </td>
                    <td>
                        <% if erp_product.nil? %>
                            <%= erp_datalist_row_actions (
                                [
                                    {
                                        text: '<i class="fa fa-download"></i> Import',
                                        href: erp_products.new_backend_product_path(hkerp_id: product["id"]),
                                        target: '_blank'
                                    }
                                ]
                            ) %>
                        <% else %>
                            <%= erp_datalist_row_actions (
                                [
                                    {
                                        text: '<i class="fa fa-pencil"></i> Edit',
                                        href: erp_products.edit_backend_product_path(erp_product),
                                        target: '_blank'
                                    },
                                    {
                                        text: '<i class="fa fa-dollar"></i> Update price',
                                        url: erp_products.hkerp_update_price_backend_products_path(ids: erp_product.id),
                                        data_method: 'PUT',
                                        hide: erp_product.price.to_f == product["price"].to_f,
                                        class: 'ajax-link'
                                    },
                                ]
                            ) %>
                        <% end %>
                    </td>
                </tr>
            <% end %>
        </tbody>
    </table>
    <% if @products.empty? %>
        <div class="datalist-empty-line"><%= t('.no_matching_records_found') %></div>
    <% end %>
</div>

<ul class="pagination">
    <li class="prev disabled"><span><i class="fa fa-angle-left"></i></span></li>
    <% (1..(@products['total'].to_i/@products['per_page'].to_i + 0.5).round(0)).each do |number| %>
        <% if params[:page].to_i == number.to_i %>
            <li class="active"><span><%= number %></span></li>
        <% else %>
            <li><a rel="next" href="list?page=<%= number %>"><%= number %></a></li>
        <% end %>
    <% end %>
    <li class="next"><a rel="next" href="/vi/backend/products/categories/list?page=2"><i class="fa fa-angle-right"></i></a></li>
</ul>